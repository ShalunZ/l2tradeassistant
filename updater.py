# updater.py
import os
import time
from utils.sound import play_notification_sound
from config import DB_PATH

def get_local_version():
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç MD5 —Ö–µ—à –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑—ã, –µ—Å–ª–∏ —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç."""
    if os.path.exists(DB_PATH):
        try:
            with open(DB_PATH, "rb") as f:
                data = f.read()
                # –ü—Ä–æ—Å—Ç–æ–π "—Ö–µ—à" ‚Äî –¥–ª–∏–Ω–∞ + –≤—Ä–µ–º—è –∏–∑–º–µ–Ω–µ–Ω–∏—è
                return f"{len(data)}_{os.path.getmtime(DB_PATH):.0f}"
        except Exception:
            return "unknown"
    return None

def get_remote_version():
    """
    –ó–∞–≥–ª—É—à–∫–∞: –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ñ–∏–∫—Ç–∏–≤–Ω—É—é –≤–µ—Ä—Å–∏—é.
    –í —Ä–µ–∞–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –±—É–¥–µ—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å version.json —Å —Å–µ—Ä–≤–µ—Ä–∞.
    """
    print("‚ö†Ô∏è Updater: –†–µ–∂–∏–º –∑–∞–≥–ª—É—à–∫–∏. –ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —É–¥–∞–ª—ë–Ω–Ω–æ–º—É —Å–µ—Ä–≤–µ—Ä—É.")
    # –ò–º–∏—Ç–∏—Ä—É–µ–º, —á—Ç–æ —É–¥–∞–ª—ë–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –≤—Å–µ–≥–¥–∞ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –ª–æ–∫–∞–ª—å–Ω–æ–π
    return get_local_version() or "1"

def download_db():
    """
    –ó–∞–≥–ª—É—à–∫–∞: –Ω–µ —Å–∫–∞—á–∏–≤–∞–µ—Ç –Ω–∏—á–µ–≥–æ.
    –í —Ä–µ–∞–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å l2trade.db —Å GitHub.
    """
    print("‚ö†Ô∏è Updater: –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ (–∑–∞–≥–ª—É—à–∫–∞).")
    return False

def check_and_update():
    """
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω—É–∂–Ω–æ –ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å –±–∞–∑—É.
    –°–µ–π—á–∞—Å –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç False ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ª–æ–∫–∞–ª—å–Ω–æ–π –∫–æ–ø–∏–µ–π.
    """
    print("üîç Updater: –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö... (–∑–∞–≥–ª—É—à–∫–∞)")
    
    if not os.path.exists(DB_PATH):
        print(f"‚ùå –§–∞–π–ª –±–∞–∑—ã –Ω–µ –Ω–∞–π–¥–µ–Ω: {DB_PATH}")
        print("üõë –†–∞–±–æ—Ç–∞ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞. –ü–æ–º–µ—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—É—é –±–∞–∑—É –≤—Ä—É—á–Ω—É—é.")
        return False

    print(f"‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–∞—è –±–∞–∑–∞: {DB_PATH}")
    print(f"‚ÑπÔ∏è  –î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–º–µ–Ω–∏—Ç–µ —Ñ–∞–π–ª –≤—Ä—É—á–Ω—É—é.")
    play_notification_sound()
    return False  # –ù–∏–∫–∞–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π